事务的创建
	显示创建
		begin transection
		commit
	隐式创建
		数据库管理系统决定那些操作是事务

事务的特点
	ACID
	A:原子性
		每个事务都是原子的，即一个事务要么全部执行，要么全部不执行
	C:一致性
		数据库只能从一个一致性状态到另一个一致性状态
	I:隔离性
		每一个事务都是看似独立完成的，不受其他事务的影响
	D:持久性
		一个事务一旦完成，后序的操作或事务不会影响该事务对数据库的更改

事务的状态
	活动的
		start之后commit之前
	部分提交
		最后一条语句执行后
	失败
		事务无法继续执行（比如死锁）
	终止
		失败后回滚且数据库到start之前的状态后
	提交
		事务完成
并发
	只考虑单机的并行
数据的不一致
	**丢失修改
	不可重复读
串行
	一个调度按一个事务全部完成再执行下一个事务，成为串行调度（串行化调度）
	
	可串行化的调度
		一个调度对数据库的影响与某一个串行调度相同，则称该调度是串行调度
	冲突
		一个调度中某相邻两个操作交换顺序会影响这两个操作本来的结果，则这两个操作是冲突的
	冲突可串行化
		一个调度是冲突可串行化的则这个调度一定是可串行化调度
		不冲突操作
			不同事务的读操作
			不同事务的读操作和写操作，但操作对象不同（这个对象考虑并发是按表，还是元组还是元素）
			不同事务的写写操作，但操作对象不同
		冲突操作	
			同一个事务的不同操作是冲突的
			不同事务对同一对象的操作，并且至少有一个操作是写
		判断依据（是否冲突可串行化）
			优先图没有环
构造冲突可串行化调度
	锁
		锁是相容的：
			如果一个事务调用了某个对象的某个锁，而另一个事务又能调用相同对象的另一个锁，则这两个锁是相容的
		锁的分类
			LOCK_S(M)只读锁
			LOCK_X(M)排它锁
			UNLOCK(M)
					LOCK_S	LOCK_X
			LOCK_S	相容	不相容
			LOCK_X	不相容	不相容
		普通锁无法构造冲突可串行化调度
		两阶段锁
			加锁阶段
				可以任意加锁
			释放锁阶段
				不能再加锁
			可以构造冲突可串行化调度，但会产生死锁
		树
			只有该事务对父节点都加锁，该事务才能对子节点加锁
			某一事务对某一节点释放锁之后无法再对它加锁
			
			可以构造不死锁的冲突可串行化调度
		时间戳（代表一类协议，事务的顺序是确定的）
			每个事务都有对应的时间戳TS(Q)
			读操作R_TS(Q)
			写操作W_TS(Q)
			对事务Q某一元素A的读操作：
				如果TS(Q)<W_TS(A)
				放弃读
				如果TS(Q)>=W_TS(A)
				读
				并更改读操作时间戳为max{W_TS(A),TS(Q)}
			对事务Q对某一元素A的写操作
				如果TS(Q)<R_TS(A)
				回滚
				如果TS(Q)<W_TS(A)
				放弃写
				否则
				写
				并更新写操作时间戳为TS(Q)
事务恢复
	数据暂存
	日志技术
		<start T>
		<Q,X,old,new>
		<commit T>
		先写日志，再写数据库
		将日志<commit T>写入硬盘时，T的其他日志要先写入磁盘
		某一操作要写入磁盘时，要先将对应的日志写入磁盘
		只有<commit T>写入磁盘后，事务才能进入提交状态
	利用日志进行恢复
		从后往前读
		将只有START没有COMMIT的操作放到undo-list中
		将既有START没有COMMIT的操作放到redo-list中
		延时更新
			undo-list
				忽略
			redo-list
				<Q,X,old,new>将X值改为new
		即时更新
			undo-list
				<Q,X,old,new>将X值改为old
			redo-list
				<Q,X,old,new>将X值改为new
		设置检查点 checkpoint
			设置检查点主要是找 T费时
			静态检查点
			<checkpoint T>
			T表示设置检查点时已经start但没有commit的事务
			出现故障后只需考虑T和检查点之后start的事务
			将检查点事务放到undo-list
			将start T1 T1放入到undo-list中
			commit T将undo-list中的T移到redo-list中
			动态检查点
			<start checkpoint T>
			可以start新事务
			可以commit事务
			可以<Q,X,old,new>
			<end checkpoint>
			不允许修改正在向磁盘输出的缓冲区
	
	
	
	
			